<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SCMXPertLite-Device Data</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../static/deviceData.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
</head>
<body>

  <!-- Sidebar Navigation -->
  <nav class="navbar" aria-label="Sidebar Navigation">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/dashboard">
          <i class="fa-solid fa-chart-column"></i> Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/MyAccount">
          <i class="fas fa-user-circle me-1"></i> My Account
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" href="/shipment">
          <i class="fa-solid fa-truck-fast"></i> Shipment
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/myShipment">
          <i class="fa-solid fa-cart-arrow-down"></i> My Shipment
        </a>
      </li>

      {% if user.role == "Admin" %}
        <li class="nav-item">
          <a class="nav-link" href="/deviceData">
            <i class="fas fa-database me-1"></i> Device Data
          </a>
        </li>
      {% else %}
        <li class="nav-item">
          <button type="button" class="nav-link btn btn-link text-muted p-0" onclick="showMessage()" aria-disabled="true" style="cursor: not-allowed;">
            <i class="fas fa-database me-1"></i> Device Data
          </button>
        </li>
      {% endif %}

      <li class="nav-item logout">
        <a class="nav-link" href="/logout">
          <i class="fas fa-sign-out-alt me-1"></i> Logout
        </a>
      </li>
    </ul>
  </nav>

  <!-- Heading -->
  <header class="Heading">
    <h1 style="color: black;">Device Data Stream</h1>
  </header>

  <!-- Table Section -->
  <section class="Devices">
    <div class="TableStyle">
      <table class="Table">
        <thead><tr><th></th></tr></thead>
        <tbody>
          <!-- Data rows go here dynamically -->
        </tbody>
      </table>
    </div>
  </section>

  <!-- JavaScript -->
  <script>
    const sessionTimeout = 10 * 60 * 1000; 
    let timeout;

    function startSessionTimeout() {
      clearTimeout(timeout);
      timeout = setTimeout(logout, sessionTimeout);
    }

    function logout() {
      window.location.href = "/logout";
    }

    document.addEventListener("mousemove", startSessionTimeout);
    document.addEventListener("keydown", startSessionTimeout);
    startSessionTimeout();

    function showMessage() {
      if (document.querySelector(".message")) return;

      const message = document.createElement("div");
      message.className = "message";
      message.textContent = "You do not have permission to access Device Data.";

      const navItems = document.querySelectorAll(".navbar-nav .nav-item");
      if (navItems.length >= 5) {
        navItems[4].appendChild(message);
        setTimeout(() => {
          if (message.parentNode) {
            message.parentNode.removeChild(message);
          }
        }, 2000);
      }
    }
  </script>

</body>
</html>
